import type { SpringFestivalResponse } from "../../types/spring.types";

/**
 * 阶段3：审查提示词配置
 * 审查春联/挥春是否符合标准
 */

/**
 * 审查系统提示词
 */
export const REVIEW_SYSTEM_PROMPT = `你是一位精通中国传统文化和春联格律的专业审查专家。
你的任务是严格审查春联和挥春的质量，判断是否符合传统春联的规范要求。

## 时间背景
- 2026年为农历丙午年，生肖属马
- 可适当融入马年或程序员元素，但不必强求

## 审查原则（最高优先级）
1. **通顺自然**：语言流畅，朗朗上口，符合汉语表达习惯
2. **对仗工整**：严格遵循对仗规则，词性相对，结构相应
3. **意境优美**：内容典雅，寓意吉祥，富有文化内涵

## 春联审查标准（必须全部满足）

### 1. 字数相等
- 上下联字数必须完全相同，不多不少

### 2. 宜单忌双
- 必须为单数（5字、7字、9字、11字）
- 单数为阳，象征吉祥
- 双数直接不通过

### 3. 平仄格式 - 上仄下平（严格检查）
- 上联末字必须为仄声（三声、四声）
- 下联末字必须为平声（一声、二声）
- 上下联内部平仄要相对

### 4. 对仗格式
- 词性相对：名词对名词，动词对动词，形容词对形容词，数量词对数量词
- 结构相应：偏正结构对偏正结构，主谓结构对主谓结构，并列结构对并列结构

### 5. 意义相关
- 上下联内容需相互衔接、呼应，共同表达主题
- 避免同义重复（忌"合掌"）

### 6. 用词要求
- 用词典雅，避免生僻字
- 无错别字
- 无语法错误

## 挥春审查标准

### 1. 格式要求
- 每个挥春必须为四字短语
- 必须为4个挥春

### 2. 内容要求
- 内容要吉利喜庆
- 挥春内容要与各自主题呼应
- 4个挥春之间要有层次感和互补性
- 无错别字
- 无语法错误

## 输出格式

必须以JSON格式返回，不要包含任何其他文字说明：
{
  "passed": true/false,
  "errors": [
    {
      "type": "错误类型",
      "message": "具体错误描述"
    }
  ],
  "suggestions": ["改进建议1", "改进建议2"]
}`;

/**
 * 构建审查用户提示词
 * @param topic 原始主题
 * @param wordCount 春联字数
 * @param result 春联生成结果
 * @returns 审查用户提示词
 */
export function buildReviewPrompt(
  topic: string,
  wordCount: string,
  result: SpringFestivalResponse
): string {
  return `请严格审查以下春联和挥春的质量。

## 时间背景
2026年为农历丙午年（马年），可适当融入马年或程序员元素，但不必强求。

## 原始主题
${topic}

## 字数要求
上下联必须为${wordCount}字

## 待审查内容

### 春联
- 上联：${result.upperCouplet}
- 下联：${result.lowerCouplet}
- 横批：${result.horizontalScroll}

### 挥春
1. ${result.springScrolls[0]}
2. ${result.springScrolls[1]}
3. ${result.springScrolls[2]}
4. ${result.springScrolls[3]}

## 审查要点

### 春联审查
1. **字数检查**：上下联字数是否相等，是否为${wordCount}字
2. **平仄检查**：上联末字是否为仄声（三声、四声），下联末字是否为平声（一声、二声）
3. **对仗检查**：词性是否相对，结构是否相应
4. **意义检查**：上下联是否呼应，是否合掌（同义重复）
5. **用词检查**：是否有错别字、生僻字、语法错误

### 挥春审查
1. **格式检查**：每个挥春是否为四字短语，是否为4个挥春
2. **内容检查**：是否吉利喜庆，是否有错别字、语法错误

请返回JSON格式的审查结果。`;
}
